<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Progressive Web Apps (PWA) - HTML Advanced</title>

    <!-- PWA Meta Tags -->
    <meta name="description" content="Learn Progressive Web App development with advanced HTML5 features">
    <meta name="theme-color" content="#2196F3">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="PWA Demo">

    <!-- Web App Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function () {
                navigator.serviceWorker.register('/sw.js')
                    .then(function (registration) {
                        console.log('SW registered: ', registration);
                    })
                    .catch(function (registrationError) {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #2196F3;
            margin-bottom: 20px;
            font-size: 2.5em;
            text-align: center;
        }

        h2 {
            color: #1976D2;
            margin-bottom: 15px;
            border-bottom: 2px solid #E3F2FD;
            padding-bottom: 10px;
        }

        h3 {
            color: #0D47A1;
            margin: 20px 0 10px 0;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .feature-card {
            background: linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 100%);
            border-radius: 10px;
            padding: 20px;
            border-left: 4px solid #2196F3;
        }

        .code-block {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }

        .demo-area {
            background: #f8f9fa;
            border: 2px dashed #2196F3;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .pwa-button {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);
        }

        .pwa-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(33, 150, 243, 0.4);
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-online {
            background-color: #4CAF50;
        }

        .status-offline {
            background-color: #F44336;
        }

        .notification-demo {
            background: linear-gradient(135deg, #FF9800, #F57C00);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header,
            .section {
                padding: 20px;
            }

            h1 {
                font-size: 2em;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header class="header">
            <h1>üöÄ Progressive Web Apps (PWA)</h1>
            <p><strong>Advanced HTML5 Features for Modern Web Applications</strong></p>
            <p>Learn how to build app-like experiences with PWAs, including offline functionality, push notifications,
                and native-like installation.</p>
        </header>

        <section class="section">
            <h2>üì± PWA Core Features</h2>
            <div class="feature-grid">
                <div class="feature-card">
                    <h3>üîß Service Workers</h3>
                    <p>Background scripts that enable offline functionality, push notifications, and background sync.
                    </p>
                </div>
                <div class="feature-card">
                    <h3>üìã Web App Manifest</h3>
                    <p>JSON file that provides metadata about your web application for installation and app-like
                        behavior.</p>
                </div>
                <div class="feature-card">
                    <h3>üîî Push Notifications</h3>
                    <p>Engage users with timely notifications even when the app is not open.</p>
                </div>
                <div class="feature-card">
                    <h3>üíæ Offline Support</h3>
                    <p>Cache resources and data to provide functionality without internet connection.</p>
                </div>
            </div>
        </section>

        <section class="section">
            <h2>üìÑ Web App Manifest Example</h2>
            <p>The manifest.json file defines how your PWA appears and behaves when installed:</p>
            <div class="code-block">
                {
                "name": "PWA Learning Demo",
                "short_name": "PWA Demo",
                "description": "A demonstration of Progressive Web App features",
                "start_url": "/",
                "display": "standalone",
                "background_color": "#2196F3",
                "theme_color": "#2196F3",
                "orientation": "portrait-primary",
                "icons": [
                {
                "src": "/icons/icon-192x192.png",
                "sizes": "192x192",
                "type": "image/png",
                "purpose": "any maskable"
                },
                {
                "src": "/icons/icon-512x512.png",
                "sizes": "512x512",
                "type": "image/png",
                "purpose": "any maskable"
                }
                ],
                "categories": ["education", "developer", "utilities"],
                "shortcuts": [
                {
                "name": "HTML Lessons",
                "short_name": "HTML",
                "description": "Quick access to HTML tutorials",
                "url": "/html",
                "icons": [{ "src": "/icons/html-96x96.png", "sizes": "96x96" }]
                }
                ]
                }
            </div>
        </section>

        <section class="section">
            <h2>‚öôÔ∏è Service Worker Implementation</h2>
            <div class="demo-area">
                <h3>Connection Status</h3>
                <p>
                    <span class="status-indicator" id="connectionStatus"></span>
                    <span id="connectionText">Checking...</span>
                </p>
                <button class="pwa-button" onclick="checkCacheStatus()">Check Cache Status</button>
                <button class="pwa-button" onclick="updateCache()">Update Cache</button>
            </div>

            <h3>Service Worker Registration Code:</h3>
            <div class="code-block">
                // Register Service Worker
                if ('serviceWorker' in navigator) {
                window.addEventListener('load', async () => {
                try {
                const registration = await navigator.serviceWorker.register('/sw.js');
                console.log('Service Worker registered:', registration);

                // Listen for updates
                registration.addEventListener('updatefound', () => {
                const newWorker = registration.installing;
                newWorker.addEventListener('statechange', () => {
                if (newWorker.state === 'installed') {
                // Show update available notification
                showUpdateNotification();
                }
                });
                });
                } catch (error) {
                console.log('Service Worker registration failed:', error);
                }
                });
                }

                // Basic Service Worker (sw.js)
                const CACHE_NAME = 'pwa-demo-v1';
                const urlsToCache = [
                '/',
                '/styles/main.css',
                '/scripts/app.js',
                '/offline.html'
                ];

                // Install event - cache resources
                self.addEventListener('install', event => {
                event.waitUntil(
                caches.open(CACHE_NAME)
                .then(cache => cache.addAll(urlsToCache))
                );
                });

                // Fetch event - serve from cache when offline
                self.addEventListener('fetch', event => {
                event.respondWith(
                caches.match(event.request)
                .then(response => {
                // Return cached version or fetch from network
                return response || fetch(event.request);
                })
                .catch(() => {
                // Show offline page for navigation requests
                if (event.request.mode === 'navigate') {
                return caches.match('/offline.html');
                }
                })
                );
                });
            </div>
        </section>

        <section class="section">
            <h2>üîî Push Notifications</h2>
            <div class="demo-area">
                <h3>Notification Demo</h3>
                <button class="pwa-button" onclick="requestNotificationPermission()">Request Permission</button>
                <button class="pwa-button" onclick="showNotification()">Show Notification</button>
                <button class="pwa-button" onclick="subscribeToUpdates()">Subscribe to Updates</button>
                <div id="notificationStatus" class="notification-demo" style="display: none;"></div>
            </div>

            <h3>Notification Implementation:</h3>
            <div class="code-block">
                // Request notification permission
                async function requestNotificationPermission() {
                if ('Notification' in window) {
                const permission = await Notification.requestPermission();
                return permission === 'granted';
                }
                return false;
                }

                // Show a simple notification
                function showNotification() {
                if (Notification.permission === 'granted') {
                new Notification('PWA Demo', {
                body: 'This is a demonstration notification!',
                icon: '/icons/icon-192x192.png',
                badge: '/icons/badge-72x72.png',
                tag: 'demo-notification',
                actions: [
                {
                action: 'view',
                title: 'View Details'
                },
                {
                action: 'close',
                title: 'Dismiss'
                }
                ]
                });
                }
                }

                // Subscribe to push notifications
                async function subscribeToPush() {
                const registration = await navigator.serviceWorker.ready;
                const subscription = await registration.pushManager.subscribe({
                userVisibleOnly: true,
                applicationServerKey: urlBase64ToUint8Array(publicVapidKey)
                });

                // Send subscription to server
                await fetch('/api/subscribe', {
                method: 'POST',
                body: JSON.stringify(subscription),
                headers: {
                'Content-Type': 'application/json'
                }
                });
                }
            </div>
        </section>

        <section class="section">
            <h2>üíæ Offline Strategies</h2>
            <div class="feature-grid">
                <div class="feature-card">
                    <h3>Cache First</h3>
                    <p>Serve from cache first, fallback to network. Best for static assets.</p>
                </div>
                <div class="feature-card">
                    <h3>Network First</h3>
                    <p>Try network first, fallback to cache. Best for dynamic content.</p>
                </div>
                <div class="feature-card">
                    <h3>Stale While Revalidate</h3>
                    <p>Serve from cache immediately, update cache in background.</p>
                </div>
                <div class="feature-card">
                    <h3>Cache Only</h3>
                    <p>Only serve from cache. Best for offline-first scenarios.</p>
                </div>
            </div>

            <h3>Caching Strategy Example:</h3>
            <div class="code-block">
                // Stale-while-revalidate strategy
                self.addEventListener('fetch', event => {
                if (event.request.destination === 'document') {
                event.respondWith(
                caches.open(CACHE_NAME).then(cache => {
                return cache.match(event.request).then(cachedResponse => {
                const fetchPromise = fetch(event.request).then(networkResponse => {
                cache.put(event.request, networkResponse.clone());
                return networkResponse;
                });

                // Return cached response immediately, update cache in background
                return cachedResponse || fetchPromise;
                });
                })
                );
                }
                });
            </div>
        </section>

        <section class="section">
            <h2>üîß Senior Engineer Tips</h2>
            <div class="feature-grid">
                <div class="feature-card">
                    <h3>‚ö° Performance</h3>
                    <ul>
                        <li>Implement proper cache versioning</li>
                        <li>Use efficient caching strategies</li>
                        <li>Monitor cache hit rates</li>
                        <li>Optimize service worker size</li>
                    </ul>
                </div>
                <div class="feature-card">
                    <h3>üõ°Ô∏è Security</h3>
                    <ul>
                        <li>Validate all cached content</li>
                        <li>Use HTTPS for all PWA features</li>
                        <li>Implement proper CORS policies</li>
                        <li>Secure notification endpoints</li>
                    </ul>
                </div>
                <div class="feature-card">
                    <h3>üìä Analytics</h3>
                    <ul>
                        <li>Track offline usage patterns</li>
                        <li>Monitor installation rates</li>
                        <li>Measure engagement metrics</li>
                        <li>A/B test notification strategies</li>
                    </ul>
                </div>
                <div class="feature-card">
                    <h3>üéØ Best Practices</h3>
                    <ul>
                        <li>Progressive enhancement approach</li>
                        <li>Graceful offline degradation</li>
                        <li>Consistent UI across platforms</li>
                        <li>Regular service worker updates</li>
                    </ul>
                </div>
            </div>
        </section>
    </div>

    <script>
        // Connection status monitoring
        function updateConnectionStatus() {
            const indicator = document.getElementById('connectionStatus');
            const text = document.getElementById('connectionText');

            if (navigator.onLine) {
                indicator.className = 'status-indicator status-online';
                text.textContent = 'Online';
            } else {
                indicator.className = 'status-indicator status-offline';
                text.textContent = 'Offline';
            }
        }

        // Monitor connection changes
        window.addEventListener('online', updateConnectionStatus);
        window.addEventListener('offline', updateConnectionStatus);
        updateConnectionStatus();

        // Notification functions
        async function requestNotificationPermission() {
            const status = document.getElementById('notificationStatus');

            if (!('Notification' in window)) {
                status.textContent = 'This browser does not support notifications';
                status.style.display = 'block';
                return;
            }

            const permission = await Notification.requestPermission();
            status.textContent = `Notification permission: ${permission}`;
            status.style.display = 'block';

            setTimeout(() => {
                status.style.display = 'none';
            }, 3000);
        }

        function showNotification() {
            if (Notification.permission === 'granted') {
                new Notification('PWA Demo Notification', {
                    body: 'This is a demonstration of PWA notifications!',
                    icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" fill="%232196F3"/><text x="50" y="55" text-anchor="middle" fill="white" font-size="20">PWA</text></svg>',
                    tag: 'pwa-demo'
                });
            } else {
                alert('Please grant notification permission first');
            }
        }

        function subscribeToUpdates() {
            const status = document.getElementById('notificationStatus');
            status.textContent = 'Subscription feature would connect to your push notification service';
            status.style.display = 'block';

            setTimeout(() => {
                status.style.display = 'none';
            }, 3000);
        }

        // Cache management
        async function checkCacheStatus() {
            if ('caches' in window) {
                const cacheNames = await caches.keys();
                alert(`Active caches: ${cacheNames.length}\nCache names: ${cacheNames.join(', ')}`);
            }
        }

        async function updateCache() {
            if ('caches' in window && 'serviceWorker' in navigator) {
                const registration = await navigator.serviceWorker.ready;
                if (registration.active) {
                    registration.active.postMessage({ action: 'skipWaiting' });
                    alert('Cache update requested. The page will reload with fresh content.');
                    window.location.reload();
                }
            }
        }

        // Install prompt handling
        let deferredPrompt;

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;

            // Show custom install button
            const installButton = document.createElement('button');
            installButton.textContent = 'Install PWA';
            installButton.className = 'pwa-button';
            installButton.onclick = () => {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the install prompt');
                    }
                    deferredPrompt = null;
                    installButton.remove();
                });
            };

            document.querySelector('.demo-area').appendChild(installButton);
        });
    </script>
</body>

</html>